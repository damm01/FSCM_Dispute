jQuery.sap.require("sap.m.TablePersoController");jQuery.sap.require("sap.ca.scfld.md.controller.BaseFullscreenController");jQuery.sap.require("sap.ui.core.format.NumberFormat");jQuery.sap.require("sap.ui.model.type.FileSize");jQuery.sap.require("sap.m.Me+
ssageBox");jQuery.sap.require("sap.ui.model.type.Date");jQuery.sap.require("sap.ui.model.type.DateTime");jQuery.sap.require("sap.ui.model.SimpleType");jQuery.sap.require("sap.m.MessageBox");jQuery.sap.require("sap.ui.comp.odata.MetadataAnalyser");jQuery.+
sap.require("fin.fscm.dm.dispute.manage.util.Util");jQuery.sap.require("fin.fscm.dm.dispute.manage.util.BatchManagement");jQuery.sap.require("fin.fscm.dm.dispute.manage.view.CreateCorrespondenceDialog");sap.ui.controller("fin.fscm.dm.dispute.manage.FSCM_+
DISPUTESExtension.view.DisputeDetailsCustom",{renderCustomerFields:function(e,t,a){var i=[];e=jQuery.extend(true,{},e);var s=parseInt(this.oDispute.SystemStatus,10);if(s>=7){this.oJsonModel.setProperty("/EditMode",false);jQuery.each(e,function(e,t){t.Dis+
playOnly=true})}jQuery.each(e,jQuery.proxy(function(s,r){if(!i[r.GroupID]){var o=new sap.ui.layout.form.SimpleForm({layout:sap.ui.layout.form.SimpleFormLayout.ResponsiveGridLayout,maxContainerCols:3,emptySpanL:0,columnsL:3,columnsM:2,width:"100%",title:r+
.GroupTitle,editable:true});o.addContent(new sap.ui.core.Title);a.addContent(o);i[r.GroupID]={elem:o}}var o=i[r.GroupID].elem;if(s>0){var n=parseInt(r.RowNo,10);var u=parseInt(e[s-1].RowNo,10);var d=parseInt(r.ColumnNo,10);var l=parseInt(e[s-1].ColumnNo,+
10);if(n-u>1&&d===l){var p=n-u-1;for(var h=0;h<p;h++){o.addContent(new sap.m.Label);o.addContent(new sap.m.Text)}}if(l===1&&d===2||l==2&&d==3){o.addContent(new sap.ui.core.Title)}}if(r.Hidden){o.addContent(new sap.m.Label);o.addContent(new sap.m.Text);re+
turn}if(!t[r.Attribute]){jQuery.sap.log.warning("fin.fscm.dm.dispute.manage.view.DisputeDetails: Metadata of dispute entity is missing for property",r.Attribute);return}var m=new sap.m.Label({text:r.Attribute,tooltip:r.Attribute,width:"100%",design:sap.m+
.LabelDesign.Bold});var c=null;var f=null;var y=null;if(r.DisplayOnly){if(r.IsCheckbox){c=new sap.m.CheckBox;c.setEnabled(false);y={path:r.Attribute};c.bindProperty("selected",y)}else{c=new sap.m.Text;c.setTextAlign(sap.ui.core.TextAlign.End);c.setWidth(+
"100%");switch(t[r.Attribute].type){case"Edm.DateTime":y={path:r.Attribute,type:"sap.ui.model.type.DateTime",formatOptions:{style:"medium"}};break;case"Edm.Date":y={path:r.Attribute,type:"sap.ui.model.type.Date",formatOptions:{style:"medium"}};break;case+
"Edm.Decimal":if(t[r.Attribute].unitField){y={parts:[r.Attribute,t[r.Attribute].unitField],formatter:this.formatCurrencyAmount}}else{y={path:r.Attribute}}break;default:if(t[r.Attribute].descr){y={path:t[r.Attribute].descr}}else{y={path:r.Attribute}}}c.bi+
ndProperty("text",y)}}else{if(r.IsCheckbox){c=new sap.m.CheckBox;y={path:r.Attribute,mode:sap.ui.model.BindingMode.TwoWay};if(t[r.Attribute].type!=="Edm.Boolean"){y.type=new fin.fscm.dm.dispute.manage.Util.CheckBoxForString}c.bindProperty("selected",y)}e+
lse if(r.IsDropdown){var g=null;if(r.Attribute==="Status"){g=new sap.ui.core.Item({text:"{StatusDescription}",key:"{Status}"});c=new sap.m.ComboBox({width:"100%",items:{path:"/GetValidStatusList",template:g,parameters:{custom:{CaseType:"'"+this.oDispute.+
CaseType+"'",CurrentStatus:"'"+this.oDispute.Status+"'"}},events:{dataReceived:function(){c.bindProperty("selectedKey",{path:r.Attribute,mode:sap.ui.model.BindingMode.TwoWay,type:new fin.fscm.dm.dispute.manage.Util.EmptyToNullType("0")})}}},change:functi+
on(e){this._handleComboBoxSelectionChange(e)}.bind(this)});this.aStatusListControls.push(c)}else{if(t[r.Attribute].annotation){var b=t[r.Attribute].annotation;g=new sap.ui.core.Item({text:"{"+b.descr+"}",key:"{"+b.key+"}"});var v=[];if(b.inParams){jQuery+
.each(b.inParams,jQuery.proxy(function(e,t){v.push(new sap.ui.model.Filter(t.valueList,sap.ui.model.FilterOperator.StartsWith,this.oDispute[t.dataProperty]))},this))}var C="";if(t[r.Attribute].type==="Edm.Decimal"){C="0"}c=new sap.m.ComboBox({width:"100%+
",items:{path:"/"+b.collectionPath,template:g,filters:v,events:{dataReceived:function(){c.bindProperty("selectedKey",{path:r.Attribute,mode:sap.ui.model.BindingMode.TwoWay,type:new fin.fscm.dm.dispute.manage.Util.EmptyToNullType(C)})}}},change:function(e+
){this._handleComboBoxSelectionChange(e)}.bind(this)})}else{if(t[r.Attribute].descr){g=new sap.ui.core.Item({text:"{"+t[r.Attribute].descr+"}",key:"{"+r.Attribute+"}"})}else{g=new sap.ui.core.Item({text:"{"+r.Attribute+"}",key:"{"+r.Attribute+"}"})}c=new+
 sap.m.ComboBox({items:[g],width:"100%"})}}}else{switch(t[r.Attribute].type){case"Edm.DateTime":c=new sap.m.DatePicker(r.Attribute);c.setWidth("100%");y={path:r.Attribute,mode:sap.ui.model.BindingMode.TwoWay,type:"fin.fscm.dm.dispute.manage.Util.UTCDate"+
};c.bindProperty("dateValue",y);break;case"Edm.Date":c=new sap.m.DatePicker;c.setWidth("100%");y={path:r.Attribute,mode:sap.ui.model.BindingMode.TwoWay};c.bindProperty("value",y);break;case"Edm.Decimal":if(t[r.Attribute].unitField){c=new sap.m.Input({wid+
th:"100%",showValueStateMessage:true,valueLiveUpdate:false});if(t[r.Attribute].maxLength){c.setMaxLength(t[r.Attribute].maxLength)}var D={IsMandatory:!t[r.Attribute].nullable};y={path:r.Attribute,mode:sap.ui.model.BindingMode.TwoWay,type:new fin.fscm.dm.+
dispute.manage.Util.CurrencyInputType(this.oBundle,D)};c.bindProperty("value",y);break}else{c=new sap.m.Input({width:"100%",showValueStateMessage:true,valueLiveUpdate:true});if(t[r.Attribute].maxLength){c.setMaxLength(t[r.Attribute].maxLength)}var D={IsM+
andatory:!t[r.Attribute].nullable};y={path:r.Attribute,mode:sap.ui.model.BindingMode.TwoWay,type:new fin.fscm.dm.dispute.manage.Util.InputValidationType(this.oBundle,D)};c.bindProperty("value",y);break}default:c=new sap.m.Input({valueLiveUpdate:true,widt+
h:"100%"});if(t[r.Attribute].descr){y={path:t[r.Attribute].descr};c.bindProperty("description",y)}y={path:r.Attribute,mode:sap.ui.model.BindingMode.TwoWay};c.bindProperty("value",y);c.setModel(this.oDataModel);if(t[r.Attribute].annotation){this.oUtil.pro+
videSearchHelp({control:c,entity:"Dispute",property:r.Attribute})}}}var S=jQuery.proxy(function(e){if(e&&e.getSource()&&e.getSource().getMetadata()&&e.getSource().getMetadata().getName()==="sap.m.DatePicker"){if(!e.getParameters().valid){var t=e.getSourc+
e();t.setValueState(sap.ui.core.ValueState.Error);this.oFormErrors[t.getId()]=t}else{if(this.oFormErrors[e.getSource().getId()]){var t=e.getSource();t.setValueState(sap.ui.core.ValueState.None);delete this.oFormErrors[t.getId()]}}}this.updateSaveButtonSt+
ate()},this);if(c.attachLiveChange){c.attachLiveChange(S)}if(c.attachSelectionChange){c.attachSelectionChange(S)}if(c.attachSelect){c.attachSelect(S)}if(c.attachChange){c.attachChange(S)}else{jQuery.sap.log.warning("fin.fscm.dm.dispute.manage.view.Disput+
eDetails: Control not supported to enable update button",c)}}if(t[r.Attribute]){if(t[r.Attribute].text){m.setText(t[r.Attribute].text)}else{m.setText(r.Attribute)}}o.addContent(m);if(f){o.addContent(f);f=null}else{o.addContent(c)}},this));this.oLoadBusyD+
ialog.close()},_handleComboBoxSelectionChange:function(e){var t=e.getSource();var a=t.getId();if(e.getParameters().itemPressed){t.setValueState(sap.ui.core.ValueState.None);delete this.oFormErrors[a]}else{if(e.getParameters().value){if(t.getSelectedKey()+
){if(t.getSelectedItem()){t.setValueState(sap.ui.core.ValueState.None);delete this.oFormErrors[a]}else{t.setValueState(sap.ui.core.ValueState.Error);this.oFormErrors[a]=true}}else{t.setValueState(sap.ui.core.ValueState.Error);this.oFormErrors[a]=true}}el+
se{t.setValueState(sap.ui.core.ValueState.None);delete this.oFormErrors[a]}}this.updateSaveButtonState()},loadCustomerFields:function(e){this.aDisputeMetadata=this.prepareMetadataForCustomerFields();var t=this.byId("customerFields");t.destroyContent();th+
is.aStatusListControls=[];var a=jQuery.proxy(function(e){var t=fin.fscm.dm.dispute.manage.util.BatchManagement.prototype.parseErrorMessage(e);this.oUtil.showErrorMessageDialog(t)},this);var i=jQuery.proxy(function(e){if(e&&e.__batchResponses&&e.__batchRe+
sponses.length>0&&e.__batchResponses[0].data&&e.__batchResponses[0].data.results){this.aAttributeSet=e.__batchResponses[0].data.results;this.renderCustomerFields(this.aAttributeSet,this.aDisputeMetadata,t)}else{jQuery.sap.log.warning("fin.fscm.dm.dispute+
.manage.view.DisputeDetails: Could not read attribute profile")}},this);var s="GetAttributeProperties?CaseType='"+e+"'";var r=[];r.push(this.oDataModel.createBatchOperation(s,"GET"));this.oDataModel.addBatchReadOperations(r);this.oDataModel.submitBatch(i+
,a)},onPhoneNoClick:function(e){var t=e.getSource();var a=t.getText();sap.m.URLHelper.triggerTel(a)},discardAllChanges:function(){if(this.hasPendingChanges()){if(!this.oDataLossDialog){this.oDataLossDialog=sap.ui.xmlfragment("DataLossDialog","fin.fscm.dm+
.dispute.manage.util.DataLossDialog",this);this.getView().addDependent(this.oDataLossDialog)}this.oDataLossDialog.open()}else{this.navBack()}},saveDisputeDetails:function(){var e=jQuery.Deferred();var t=jQuery.Deferred();var a=this.oUnchangedDispute.Stat+
us!==this.oDispute.Status;var i=jQuery.proxy(function(){t.resolveWith(this)},this);var s=jQuery.proxy(function(e){t.rejectWith(this,[e])},this);t.done(function(){this.getDisputeEntityPathFromCaseGuid().done(function(t){this.sPath=t;if(a){this.triggerRefr+
eshStatusLists()}e.resolveWith(this)}).fail(function(){e.rejectWith(this)})});t.fail(function(t){e.rejectWith(this,[t])});if(this.oDataModel.hasPendingChanges()){this.oDataModel.submitChanges(i,s)}else{e.resolveWith(this)}return e.promise()},triggerRefre+
shStatusLists:function(){jQuery.each(this.aStatusListControls,jQuery.proxy(function(e,t){var a=t.getBindingInfo("items");var i=false;if(a){if(a.parameters&&a.parameters.custom&&a.parameters.custom.CurrentStatus){if(a.parameters.custom.CurrentStatus!=="'"+
+this.oDispute.Status+"'"){i=true;a.parameters.custom.CurrentStatus="'"+this.oDispute.Status+"'"}}if(i){t.bindItems(a)}}},this))},saveNote:function(){var e=jQuery.Deferred();var t=jQuery.Deferred();var a=this.byId("NoteInput");var i=a.getValue();if(this.+
oDataModel.hasPendingChanges()){e.rejectWith(this);return e}var s={NoteContent:i,CaseGuid:this.sCaseGuid};var r=jQuery.proxy(function(e,a){t.resolveWith(this,[e,a])},this);var o=jQuery.proxy(function(e){t.rejectWith(this,[e])},this);var n={success:r,erro+
r:o,async:true};t.done(function(t,i){var s=i&&i.data&&i.data.__batchResponses&&i.data.__batchResponses.length&&i.data.__batchResponses[0]&&i.data.__batchResponses[0].__changeResponses&&i.data.__batchResponses[0].__changeResponses.length&&i.data.__batchRe+
sponses[0].__changeResponses[0]&&i.data.__batchResponses[0].__changeResponses[0].statusCode&&parseInt(i.data.__batchResponses[0].__changeResponses[0].statusCode)||undefined;if(s===201){a.setValue("");this.getDisputeEntityPathFromCaseGuid().then(function(+
a){this.sPath=a;e.resolveWith(this,[t])},function(){e.rejectWith(this)})}else{e.rejectWith(this,[t,i])}});t.fail(function(t){e.rejectWith(this,[t])});if(i!==""){this.oDataModel.create("/CaseNoteSet",s,n)}else{e.resolveWith(this)}return e.promise()},addAt+
tachment:function(){var e=jQuery.Deferred();var t=jQuery.Deferred();var a=jQuery.proxy(this.onAttachmentUploadComplete,this,t);var i=this.byId("attachmentFileUploader");if(this.oDataModel.hasPendingChanges()){e.rejectWith(this);return e.promise()}t.done(+
function(t){if(i.clear){i.clear()}else{i.setValue("")}this.byId("BtnCleanAttachmentFileUploader").setEnabled(false);this.getDisputeEntityPathFromCaseGuid().then(function(a){this.sPath=a;e.resolveWith(this,[t])},function(){e.rejectWith(this)})});t.fail(fu+
nction(t){e.rejectWith(this,[t])});t.always(function(){i.detachUploadComplete(a)});if(i.getValue()!==""){i.attachUploadComplete(a);i.upload()}else{e.resolveWith(this)}return e.promise()}});                                                                  